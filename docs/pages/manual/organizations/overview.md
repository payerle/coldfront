# How to track Projects and Users by Department/Organizational Unit

ColdFront allows one to associate [Projects](../projects) and [Users](../users) by department
or whatever organizational structure your institution uses.  

## OrganizationLevels {#orglevels}

Because the organizational structure and needs of different institutions can varying greatly,
ColdFront uses a flexible system for representing this.  The table OrganizationLevel defines
the differnt levels in the organizational hierarchy.  Each entry has a _name_, an integer _level_,
and a pointer to its _parent_ in the hierarchy.  One and only one entry is permitted not to have
a _parent_, and it must have the highest value for _level_.  Everyother entry must have a _parent_,
and the value of _level_ field for its _parent_ must be greater than the value of its _level_ field.

These constraints prevent cycles, and basically mean the table produces a simple chain of finite
length like 
```
TopLevel => NextLevel => ... => PenultimateLevel => LastLevel
```

The initial setup defines a simple structure
  - University (level=40, no parent)
  - College (level=30, parent=University)
  - Department (level=20, parent=College)

The names are mostly not used except in some of the ColdFront Admin pages, so just choose values
which make sense in your organizational structure.  The values for level are really only used
for ordering the list.

**NOTE:** Take some care in setting this up, as it can be difficult to make changes after the fact
without deleting all of your Organization data.  The names can be changed without any impact, as can
the values for the levels (as long as you maintain the entries in the same order).  Also, you
can easily add new entries at the bottom (e.g. a ResearchGroup with parent=Department).  But it is
non-trivial to add a new top level (e.g. a level above University) or adding levels between existing
levels without deleting the table (which would also delete all of the Organizations). If such changes
are necessary after you have already populated the Organization table and associated Users and Projects,
I would advise you actually add any required new entries to the bottom (below Department) and rename
the existing levels as needed.  You will also likely need to adjust the OrganizationLevel reference
in all of the affected Organization entries, but that can probably be done directly in the database
with the appropriate SQL.

Although this table is typically small enough to enter manually inside the ColdFront web GUI,
there is a command `import_organization_levels` which will import a list of organization levels
from a file; see [the command-line reference page](cmdline.md#import_organization_levels) for 
more details.
 
## Organizations {#orgs}

This is the table that defines all of the Organizations in your hierarchy.  Each Organization has
the following attributes:
   - `code`: a (short) abbreviation for the Organization.  Cannot contain a hyphen ('-')
   - `shortname`: a medium length text description of the Organization
   - `longname`: a longer text description
   - `organization_level`: a pointer to an entry in the OrganizationLevel table indicating at what level in the hierarchy this organization is
   - `parent`: the parent Organization.  This is required to have an organization_level pointing to the parent of the OrganizationLevel pointed to by this object (or no parent if our organization_level is the top level)
   - `is_selectable_for_user`: Boolean.  This controls whether this Organization is allowed to be selected for User objects
   - `is_selectable_for_project`: Boolean.  This controls whether this Organization is allowed to be selected for Project objects

The pairs (code, parent), (shortname, parent), and (longname, parent) must be pairwise unique (where we
include the case where parent=NULL, i.e. no two Organizations with parent=NULL can have the same code).
This allows for cases wherein your organizational chart has two distinct universities each with its own
"Chemistry Department"; this is allowed because the parents will be different.

We typically display an Organization by its `fullcode` (generated by concatenating the `code` of the object
and all of its ancestors with a hypen ('-') delimiter, in order from highest to lowest).  So for the
Chemistry Department (code CHEM) in the College of Computer, Math, and Natural Sciences (CMNS) at the
University of Maryland (UMD), the fullcode would be 'UMD-CMNS-CHEM'.  We also sometimes use what is called
the `semifullcode`, which is similar except that the final code component is replaced by the `shortname`,
so for our previous example it would be 'UMD-CMNS-Chemistry'.  Both of these will uniquely
reference an Organization.  We typically use a short (usually 3 or 4 character) abbreviation for the `code`, 
with more readable but still short "nickname" for the `shortname`, and the full blown name for `longname`.
E.g., our chemistry department example might have `code` set to "CHEM", the `shortname` set to
"Chemistry", and the `longname` set to "Department of Chemistry & Biochemistry".

The Organizations are arranged in a hierarchy, as directors often will wish to see reports broken
down not just be departments but by higher levels like college or university as well.  The levels
allowed (and most importantly the number of levels) is defined by the [OrganizationLevel](#orglevels)
model.  

When viewing/assigning Organizations to Users or Projects, you typically only wish to assign
the most specific ones.  E.g., for a Project belonging to a PI in Chemistry, you typically want it
assigned to Chemistry (unless your organizational scheme has levels below department) and not
just to the college or university.  The two boolean fields `is_selectable_for_user` and
`is_selectable_for_project` can be set to control which Organizations are visible to and/or
selectable by users when viewing their User profiles (`is_selectable_for_user`) and
Projects (`is_selectable_for_project`).  Typically we set these as true for the lowest level "leaf"
Organizations (i.e. Organizations with no children), and false on Organizations with children.
Note that these do not all have to be at the lowest OrganizationLevel --- i.e. if there is a college
or center which does not have departments beneath it, you might make it a "leaf" Organization
without any children and with the selectable flags set.

There is a command `import_organizations` which will import a list of organizations
from a file; see [the command-line reference page](cmdline.md#import_organizations) for 
more details.
 
## Directory2Organization 

This table maps the strings from an LDAP attribute to elements 
of the [Organization model](#orgs).

As this is only for LDAP integration, it is discussed more
on the [LDAP integration page](ldap.md#dir2orgs).

